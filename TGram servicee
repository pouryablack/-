import telebot
from telebot import types
import logging
import datetime
import time

# ØªÙ†Ø¸ÛŒÙ… Ù„Ø§Ú¯ Ø¨Ø±Ø§ÛŒ Ø¯ÛŒØ¨Ø§Ú¯
logging.basicConfig(level=logging.DEBUG, format='%(asctime)s - %(levelname)s - %(message)s')

# Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø±Ø¨Ø§Øª
TOKEN = "8120534894:AAGqGH-kfv2sgU2BeYT9bHDB8M0LkM43gqw"
ADMIN_ID_MAIN = 5145620503
ADMIN_ID_SECONDARY = 6811076207
CHANNEL_USERNAME = "@premiumgiftshoop"
ADMIN_TAG_MAIN = "@pourya_xo"
ADMIN_TAG_SECONDARY = "@Moeinodow"
CARD_NUMBER = "5859831209300457"
CARD_OWNER = "Ù¾ÙˆØ±ÛŒØ§ Ù¾Ø±ÙˆÛŒÙ†ÛŒ"
BANK_NAME = "Ø¨Ø§Ù†Ú© ØªØ¬Ø§Ø±Øª"

bot = telebot.TeleBot(TOKEN)

# Ù…Ø­ØµÙˆÙ„Ø§Øª Ù¾Ø±Ù…ÛŒÙˆÙ…
premium_products = {
    "premium_3": {"name": "Ø§Ø´ØªØ±Ø§Ú© 3 Ù…Ø§Ù‡Ù‡", "price": "1,100,000 ØªÙˆÙ…Ø§Ù†", "description": "Ø§Ø´ØªØ±Ø§Ú© 3 Ù…Ø§Ù‡Ù‡ Ø¨Ø§ Ø§Ù…Ú©Ø§Ù†Ø§Øª ÙˆÛŒÚ˜Ù‡"},
    "premium_6": {"name": "Ø§Ø´ØªØ±Ø§Ú© 6 Ù…Ø§Ù‡Ù‡", "price": "1,450,000 ØªÙˆÙ…Ø§Ù†", "description": "Ø§Ø´ØªØ±Ø§Ú© 6 Ù…Ø§Ù‡Ù‡ Ø¨Ø§ Ø§Ù…Ú©Ø§Ù†Ø§Øª ÙˆÛŒÚ˜Ù‡"},
    "premium_12": {"name": "Ø§Ø´ØªØ±Ø§Ú© 1 Ø³Ø§Ù„Ù‡", "price": "2,550,000 ØªÙˆÙ…Ø§Ù†", "description": "Ø§Ø´ØªØ±Ø§Ú© 1 Ø³Ø§Ù„Ù‡ Ø¨Ø§ Ø§Ù…Ú©Ø§Ù†Ø§Øª ÙˆÛŒÚ˜Ù‡"}
}

# Ù…Ø­ØµÙˆÙ„Ø§Øª Ø§Ø³ØªØ§Ø±Ø²
star_products = {
    "star_50": {"name": "50 Ø§Ø³ØªØ§Ø±", "price": "75,000 ØªÙˆÙ…Ø§Ù†", "description": "50 Ø§Ø³ØªØ§Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ù¾Ù„ØªÙØ±Ù…"},
    "star_75": {"name": "75 Ø§Ø³ØªØ§Ø±", "price": "110,000 ØªÙˆÙ…Ø§Ù†", "description": "75 Ø§Ø³ØªØ§Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ù¾Ù„ØªÙØ±Ù…"},
    "star_100": {"name": "100 Ø§Ø³ØªØ§Ø±", "price": "140,000 ØªÙˆÙ…Ø§Ù†", "description": "100 Ø§Ø³ØªØ§Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ù¾Ù„ØªÙØ±Ù…"},
    "star_150": {"name": "150 Ø§Ø³ØªØ§Ø±", "price": "220,000 ØªÙˆÙ…Ø§Ù†", "description": "150 Ø§Ø³ØªØ§Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ù¾Ù„ØªÙØ±Ù…"},
    "star_250": {"name": "250 Ø§Ø³ØªØ§Ø±", "price": "330,000 ØªÙˆÙ…Ø§Ù†", "description": "250 Ø§Ø³ØªØ§Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ù¾Ù„ØªÙØ±Ù…"},
    "star_350": {"name": "350 Ø§Ø³ØªØ§Ø±", "price": "475,000 ØªÙˆÙ…Ø§Ù†", "description": "350 Ø§Ø³ØªØ§Ø± Ø¨Ø±Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø¯Ø± Ù¾Ù„ØªÙØ±Ù…"},
    "star_more": {"name": "Ø³ÙØ§Ø±Ø´ Ø¨ÛŒØ´ØªØ±", "price": None, "description": "Ø³ÙØ§Ø±Ø´ Ø§Ø³ØªØ§Ø±Ù‡Ø§ÛŒ Ø¨ÛŒØ´ØªØ± Ø¨Ø§ Ù‡Ù…Ø§Ù‡Ù†Ú¯ÛŒ Ø§Ø¯Ù…ÛŒÙ†"}
}

orders = {}

def is_user_subscribed(user_id):
    try:
        member = bot.get_chat_member(CHANNEL_USERNAME, user_id)
        return member.status in ['member', 'administrator', 'creator']
    except Exception as e:
        logging.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ú©Ø§Ø±Ø¨Ø± {user_id}: {e}")
        return False

def show_main_panel(chat_id, message_id=None):
    if not is_user_subscribed(chat_id):
        markup = types.InlineKeyboardMarkup()
        channel_url = f"https://t.me/{CHANNEL_USERNAME.lstrip('@')}"
        markup.add(types.InlineKeyboardButton("ğŸ“¢ Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± Ú©Ø§Ù†Ø§Ù„", url=channel_url))
        markup.add(types.InlineKeyboardButton("âœ… Ø¹Ø¶ÙˆÛŒØª Ø§Ù†Ø¬Ø§Ù… Ø´Ø¯", callback_data="check_join"))
        bot.send_message(chat_id, f"â›” Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± Ú©Ø§Ù†Ø§Ù„ {CHANNEL_USERNAME} Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø§Ø³Øª! Ù„Ø·ÙØ§Ù‹ Ø¨Ù¾ÛŒÙˆÙ†Ø¯ÛŒØ¯.", reply_markup=markup)
        return
    
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, selective=True)
    markup.row("â„¹ï¸ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡", "ğŸ’ Ù¾Ù†Ù„ Ù¾Ø±Ù…ÛŒÙˆÙ…", "â­ Ù¾Ù†Ù„ Ø§Ø³ØªØ§Ø±Ø²")
    markup.row("ğŸ§‘â€ğŸ’¼ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ†", "ğŸ“‹ ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´")
    markup.row("ğŸ“ Menu")
    
    welcome_text = (
        "Ø¨Ù‡ Ø±Ø¨Ø§Øª Ù…Ø§ Ø®ÙˆØ´ Ø¢Ù…Ø¯ÛŒØ¯! Ø¨Ø±Ø§ÛŒ Ø´Ø±ÙˆØ¹ØŒ ÛŒÚ©ÛŒ Ø§Ø² Ú¯Ø²ÛŒÙ†Ù‡â€ŒÙ‡Ø§ÛŒ Ø²ÛŒØ± Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯:\n"
        "- ğŸ’ Ù¾Ù†Ù„ Ù¾Ø±Ù…ÛŒÙˆÙ…: Ø§Ø´ØªØ±Ø§Ú©â€ŒÙ‡Ø§ÛŒ ÙˆÛŒÚ˜Ù‡\n"
        "- â­ Ù¾Ù†Ù„ Ø§Ø³ØªØ§Ø±Ø²: Ø§Ø³ØªØ§Ø±Ù‡Ø§ÛŒ Ø¬Ø°Ø§Ø¨\n"
        "- â„¹ï¸ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡: Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨ÛŒØ´ØªØ±\n"
        "- ğŸ“‹ ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´: Ø¨Ø±Ø±Ø³ÛŒ Ø³ÙØ§Ø±Ø´â€ŒÙ‡Ø§\n"
        "- ğŸ§‘â€ğŸ’¼ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ†: Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒ"
    )
    
    if message_id:
        try:
            bot.delete_message(chat_id, message_id)
        except Exception as e:
            logging.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù… {message_id} Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {chat_id}: {e}")
    
    bot.send_message(chat_id, welcome_text, reply_markup=markup)

@bot.message_handler(commands=['start'])
def start(message):
    show_main_panel(message.chat.id)

@bot.callback_query_handler(func=lambda call: call.data == "check_join")
def check_join(call):
    user_id = call.from_user.id
    chat_id = call.message.chat.id
    message_id = call.message.message_id
    
    if is_user_subscribed(user_id):
        bot.edit_message_text(
            chat_id=chat_id,
            message_id=message_id,
            text="âœ… Ø¹Ø¶ÙˆÛŒØª Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªØ£ÛŒÛŒØ¯ Ø´Ø¯! Ø­Ø§Ù„Ø§ Ù…ÛŒâ€ŒØªÙˆØ§Ù†ÛŒØ¯ Ø§Ø² Ø±Ø¨Ø§Øª Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",
            reply_markup=None
        )
        show_main_panel(chat_id)
    else:
        bot.answer_callback_query(call.id, "â›” Ù‡Ù†ÙˆØ² Ø¹Ø¶Ùˆ Ú©Ø§Ù†Ø§Ù„ Ù†ÛŒØ³ØªÛŒØ¯! Ø¨Ù¾ÛŒÙˆÙ†Ø¯ÛŒØ¯.")
        logging.info(f"Ú©Ø§Ø±Ø¨Ø± {user_id} Ø¨Ø±Ø±Ø³ÛŒ Ø¹Ø¶ÙˆÛŒØª Ø±Ø§ Ø±Ø¯ Ú©Ø±Ø¯")

@bot.message_handler(func=lambda m: m.text == "â„¹ï¸ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡")
def show_guide(message):
    if not is_user_subscribed(message.chat.id):
        show_main_panel(message.chat.id)
        return
    
    guide_text = (
        "ğŸ¯ Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ø±Ø¨Ø§Øª:\n\n"
        "1. Ø¨Ø±Ø§ÛŒ Ø®Ø±ÛŒØ¯ Ù¾Ø±Ù…ÛŒÙˆÙ… ÛŒØ§ Ø§Ø³ØªØ§Ø±Ø²ØŒ Ø¨Ù‡ Ù¾Ù†Ù„ Ù…Ø±Ø¨ÙˆØ·Ù‡ Ø¨Ø±ÙˆÛŒØ¯.\n"
        "2. ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø¨Ø§ @ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ø­Ø¯Ø§Ù‚Ù„ Ûµ Ú©Ø§Ø±Ø§Ú©ØªØ±).\n"
        "3. Ù¾Ø±Ø¯Ø§Ø®Øª Ø±Ø§ Ø§Ø² Ø·Ø±ÛŒÙ‚ Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡ÛŒØ¯.\n"
        "4. ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´ Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ø§ Ø¯Ú©Ù…Ù‡ 'ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´' Ú†Ú© Ú©Ù†ÛŒØ¯.\n"
        "5. Ø¨Ø±Ø§ÛŒ Ù¾Ø´ØªÛŒØ¨Ø§Ù†ÛŒØŒ Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§ ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯.\n\n"
        "ğŸ“Œ Ù†Ú©ØªÙ‡: Ø¹Ø¶ÙˆÛŒØª Ø¯Ø± Ú©Ø§Ù†Ø§Ù„ Ø§Ø¬Ø¨Ø§Ø±ÛŒ Ø§Ø³Øª!\n"
        "â³ Ø²Ù…Ø§Ù† ØªØ­ÙˆÛŒÙ„: 5 Ø¯Ù‚ÛŒÙ‚Ù‡ ØªØ§ 1 Ø³Ø§Ø¹Øª"
    )
    bot.send_message(message.chat.id, guide_text)

@bot.message_handler(func=lambda m: m.text == "ğŸ’ Ù¾Ù†Ù„ Ù¾Ø±Ù…ÛŒÙˆÙ…")
def show_premium_panel(message):
    if not is_user_subscribed(message.chat.id):
        show_main_panel(message.chat.id)
        return
    
    markup = types.InlineKeyboardMarkup()
    for key, product in premium_products.items():
        markup.add(types.InlineKeyboardButton(
            f"{product['name']} - {product['price']}", 
            callback_data=f"premium_{key}"
        ))
    
    back_markup = types.ReplyKeyboardMarkup(resize_keyboard=True, selective=True)
    back_markup.row("ğŸ”™ Ø¨Ø±Ú¯Ø´Øª")
    
    info_text = (
        "ğŸ’ Ù¾Ù†Ù„ Ù¾Ø±Ù…ÛŒÙˆÙ…:\n"
        "Ù¾Ø±Ù…ÛŒÙˆÙ…â€ŒÙ‡Ø§ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ú¯ÛŒÙØª Ø§Ø®ØªØµØ§ØµÛŒ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯!\n"
        "â³ Ø²Ù…Ø§Ù† ØªØ­ÙˆÛŒÙ„: Ø¨ÛŒÙ† Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡ ØªØ§ Û± Ø³Ø§Ø¹Øª Ø¯Ø± Ø·ÙˆÙ„ Ø±ÙˆØ²"
    )
    
    try:
        bot.delete_message(message.chat.id, message.message_id)
    except Exception as e:
        logging.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {message.chat.id}: {e}")
    
    bot.send_message(message.chat.id, info_text, reply_markup=markup)
    bot.send_message(
        message.chat.id, 
        "Ù„Ø·ÙØ§Ù‹ ÛŒÚ©ÛŒ Ø§Ø² Ù…Ø­ØµÙˆÙ„Ø§Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒØŒ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.", 
        reply_markup=back_markup
    )

@bot.message_handler(func=lambda m: m.text == "â­ Ù¾Ù†Ù„ Ø§Ø³ØªØ§Ø±Ø²")
def show_star_panel(message):
    if not is_user_subscribed(message.chat.id):
        show_main_panel(message.chat.id)
        return
    
    markup = types.InlineKeyboardMarkup()
    for key, product in star_products.items():
        price_text = "ØªÙ…Ø§Ø³ Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ†" if product['price'] is None else product['price']
        markup.add(types.InlineKeyboardButton(
            f"{product['name']} - {price_text}", 
            callback_data=f"star_{key}"
        ))
    
    back_markup = types.ReplyKeyboardMarkup(resize_keyboard=True, selective=True)
    back_markup.row("ğŸ”™ Ø¨Ø±Ú¯Ø´Øª")
    
    info_text = (
        "â­ Ù¾Ù†Ù„ Ø§Ø³ØªØ§Ø±Ø²:\n"
        "Ø§Ø³ØªØ§Ø±Ø²Ù‡Ø§ Ø¨Ù‡â€ŒØµÙˆØ±Øª Ú¯ÛŒÙØª Ø¬Ø°Ø§Ø¨ Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§ Ø§Ø±Ø³Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯!\n"
        "â³ Ø²Ù…Ø§Ù† ØªØ­ÙˆÛŒÙ„: Ø¨ÛŒÙ† Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡ ØªØ§ Û± Ø³Ø§Ø¹Øª"
    )
    
    try:
        bot.delete_message(message.chat.id, message.message_id)
    except Exception as e:
        logging.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {message.chat.id}: {e}")
    
    bot.send_message(message.chat.id, info_text, reply_markup=markup)
    bot.send_message(
        message.chat.id, 
        "Ù„Ø·ÙØ§Ù‹ ÛŒÚ©ÛŒ Ø§Ø² Ù…Ø­ØµÙˆÙ„Ø§Øª Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø¨Ø±Ø§ÛŒ Ø¨Ø§Ø²Ú¯Ø´Øª Ø¨Ù‡ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒØŒ Ø¯Ú©Ù…Ù‡ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø²Ù†ÛŒØ¯.", 
        reply_markup=back_markup
    )

@bot.callback_query_handler(func=lambda call: call.data.startswith(("premium_", "star_")))
def process_product(call):
    user_id = call.from_user.id
    if not is_user_subscribed(user_id):
        show_main_panel(user_id)
        return
    
    product_type, product_key = call.data.split("_", 1)
    
    if product_type == "premium":
        product = premium_products.get(product_key)
    else:  # star
        product = star_products.get(product_key)
    
    if not product:
        bot.send_message(user_id, "âŒ Ù…Ø­ØµÙˆÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø±!")
        logging.error(f"Ù…Ø­ØµÙˆÙ„ Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ù†ØªØ®Ø§Ø¨ Ø´Ø¯: {call.data}")
        return
    
    if product_type == "star" and product_key == "star_more":
        bot.send_message(
            user_id,
            f"Ø§Ú¯Ø± Ù‚ØµØ¯ Ø³ÙØ§Ø±Ø´ Ø¨ÛŒØ´ØªØ±ÛŒ Ø¯Ø§Ø±ÛŒØ¯ Ù„Ø·ÙØ§Ù‹ Ø¨Ù‡ Ø¢ÛŒØ¯ÛŒ Ø§Ø¯Ù…ÛŒÙ† Ù¾ÛŒØ§Ù… Ø¨Ø¯ÛŒØ¯ Ùˆ Ù…Ù‚Ø¯Ø§Ø± Ø®ÙˆØ¯ØªÙˆÙ† Ø±Ùˆ Ù…Ø´Ø®Øµ Ú©Ù†ÛŒØ¯ Ù…Ù…Ù†ÙˆÙ†Ù… Ø§Ø² ØªÙˆØ¬Ù‡ØªÙˆÙ†\n"
            f"Ø¢ÛŒØ¯ÛŒ Ø§Ø¯Ù…ÛŒÙ†: {ADMIN_TAG_MAIN}"
        )
        try:
            bot.delete_message(user_id, call.message.message_id)
        except Exception as e:
            logging.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ù¾Ù†Ù„ Ø§Ø³ØªØ§Ø±Ø² Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {user_id}: {e}")
        return
    
    orders[user_id] = {
        "product": product['name'], 
        "status": "Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯", 
        "price": product['price'],
        "timestamp": datetime.datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
        "type": product_type,
        "last_message_id": call.message.message_id
    }
    
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, selective=True)
    markup.row("ğŸš« Ú©Ù†Ø³Ù„ Ø³ÙØ§Ø±Ø´")
    
    product_info = (
        f"ğŸ“¦ Ù…Ø­ØµÙˆÙ„ Ø§Ù†ØªØ®Ø§Ø¨â€ŒØ´Ø¯Ù‡:\n"
        f"ğŸ· Ù†Ø§Ù…: {product['name']}\n"
        f"ğŸ’° Ù‚ÛŒÙ…Øª: {product['price']}\n"
        f"ğŸ“ ØªÙˆØ¶ÛŒØ­Ø§Øª: {product['description']}\n\n"
        f"âš ï¸ Ù„Ø·ÙØ§Ù‹ ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø¨Ø§ @ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯ (Ø­Ø¯Ø§Ù‚Ù„ Ûµ Ú©Ø§Ø±Ø§Ú©ØªØ± Ø¨Ø¯ÙˆÙ† Ø§Ø­ØªØ³Ø§Ø¨ @):"
    )
    
    try:
        bot.delete_message(user_id, call.message.message_id)
    except Exception as e:
        logging.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ø§Ù†ØªØ®Ø§Ø¨ Ù…Ø­ØµÙˆÙ„ Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {user_id}: {e}")
    
    sent_message = bot.send_message(user_id, product_info, reply_markup=markup)
    orders[user_id]["last_message_id"] = sent_message.message_id
    bot.register_next_step_handler_by_chat_id(user_id, process_username, product)

def process_username(message, product):
    user_id = message.chat.id
    if not is_user_subscribed(user_id):
        show_main_panel(user_id)
        return
    
    if message.text == "ğŸš« Ú©Ù†Ø³Ù„ Ø³ÙØ§Ø±Ø´":
        if user_id in orders:
            try:
                bot.delete_message(user_id, orders[user_id]["last_message_id"])
            except Exception as e:
                logging.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù… ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {user_id}: {e}")
            del orders[user_id]
            bot.send_message(user_id, "âœ… Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ú©Ù†Ø³Ù„ Ø´Ø¯.", reply_markup=types.ReplyKeyboardRemove())
            show_main_panel(user_id)
        return
    
    username = message.text.strip()
    if not username.startswith('@'):
        bot.send_message(user_id, "âŒ ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø¨Ø§ÛŒØ¯ Ø¨Ø§ @ Ø´Ø±ÙˆØ¹ Ø´ÙˆØ¯!")
        bot.register_next_step_handler_by_chat_id(user_id, process_username, product)
        return
    
    username_without_at = username[1:]
    if len(username_without_at) < 5:
        bot.send_message(user_id, "âŒ ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø¨Ø§ÛŒØ¯ Ø­Ø¯Ø§Ù‚Ù„ Ûµ Ú©Ø§Ø±Ø§Ú©ØªØ± (Ø¨Ø¯ÙˆÙ† Ø§Ø­ØªØ³Ø§Ø¨ @) Ø¯Ø§Ø´ØªÙ‡ Ø¨Ø§Ø´Ø¯!")
        bot.register_next_step_handler_by_chat_id(user_id, process_username, product)
        return
    
    if not all(c.isalnum() or c == '_' for c in username_without_at):
        bot.send_message(user_id, "âŒ ÛŒÙˆØ²Ø±Ù†ÛŒÙ… ÙÙ‚Ø· Ø¨Ø§ÛŒØ¯ Ø´Ø§Ù…Ù„ Ø­Ø±ÙˆÙØŒ Ø§Ø¹Ø¯Ø§Ø¯ Ùˆ _ Ø¨Ø§Ø´Ø¯.")
        bot.register_next_step_handler_by_chat_id(user_id, process_username, product)
        return
    
    orders[user_id]["username"] = username
    
    payment_info = (
        "ğŸ¦ Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª:\n\n"
        f"ğŸ”¢ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª:\n{CARD_NUMBER}\n"
        f"ğŸ‘¤ Ù†Ø§Ù… ØµØ§Ø­Ø¨ Ø­Ø³Ø§Ø¨: {CARD_OWNER}\n"
        f"ğŸ¦ Ø¨Ø§Ù†Ú©: {BANK_NAME}\n\n"
        f"ğŸ’° Ù…Ø¨Ù„Øº Ù‚Ø§Ø¨Ù„ Ù¾Ø±Ø¯Ø§Ø®Øª: {orders[user_id]['price']}\n"
        f"ğŸ›’ Ù…Ø­ØµÙˆÙ„: {orders[user_id]['product']}\n\n"
        "âš ï¸ Ù„Ø·ÙØ§Ù‹ Ø¹Ú©Ø³ ÙÛŒØ´ ÙˆØ§Ø±ÛŒØ² Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯ ÛŒØ§ Ø³ÙØ§Ø±Ø´ Ø±Ø§ Ú©Ù†Ø³Ù„ Ú©Ù†ÛŒØ¯."
    )
    
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, selective=True)
    markup.row("ğŸš« Ú©Ù†Ø³Ù„ Ø³ÙØ§Ø±Ø´")
    
    try:
        bot.delete_message(user_id, orders[user_id]["last_message_id"])
    except Exception as e:
        logging.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù… ÛŒÙˆØ²Ø±Ù†ÛŒÙ… Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {user_id}: {e}")
    
    sent_message = bot.send_message(user_id, payment_info, reply_markup=markup)
    orders[user_id]["last_message_id"] = sent_message.message_id
    bot.register_next_step_handler_by_chat_id(user_id, process_receipt, product, username)

def process_receipt(message, product, username):
    user_id = message.chat.id
    if not is_user_subscribed(user_id):
        show_main_panel(user_id)
        return
    
    if message.text == "ğŸš« Ú©Ù†Ø³Ù„ Ø³ÙØ§Ø±Ø´":
        if user_id in orders:
            try:
                bot.delete_message(user_id, orders[user_id]["last_message_id"])
            except Exception as e:
                logging.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {user_id}: {e}")
            del orders[user_id]
            bot.send_message(user_id, "âœ… Ø³ÙØ§Ø±Ø´ Ú©Ù†Ø³Ù„ Ø´Ø¯.", reply_markup=types.ReplyKeyboardRemove())
            show_main_panel(user_id)
        return
    
    if message.content_type != 'photo':
        markup = types.ReplyKeyboardMarkup(resize_keyboard=True, selective=True)
        markup.row("ğŸš« Ú©Ù†Ø³Ù„ Ø³ÙØ§Ø±Ø´")
        bot.send_message(user_id, "âŒ ÙÙ‚Ø· Ø¹Ú©Ø³ ÙÛŒØ´ Ø±Ø§ Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯.", reply_markup=markup)
        bot.register_next_step_handler_by_chat_id(user_id, process_receipt, product, username)
        return
    
    orders[user_id]["receipt"] = True
    orders[user_id]["status"] = "Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ†"
    
    order_details = (
        f"ğŸ“¥ Ø³ÙØ§Ø±Ø´ Ø¬Ø¯ÛŒØ¯ (Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª):\n\n"
        f"ğŸ‘¤ Ø®Ø±ÛŒØ¯Ø§Ø±:\n"
        f"   â”œ Ù†Ø§Ù…: {message.from_user.first_name or 'Ù†Ø¯Ø§Ø±Ø¯'}\n"
        f"   â”œ Ø¢ÛŒØ¯ÛŒ: {user_id}\n"
        f"   â”” ÛŒÙˆØ²Ø±Ù†ÛŒÙ…: @{message.from_user.username or 'Ù†Ø¯Ø§Ø±Ø¯'}\n\n"
        f"ğŸ›’ Ù…Ø­ØµÙˆÙ„:\n"
        f"   â”œ Ù†Ø§Ù…: {product['name']}\n"
        f"   â”” Ù‚ÛŒÙ…Øª: {product['price']}\n\n"
        f"ğŸ“ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§Ø¶Ø§ÙÙ‡:\n"
        f"   â”œ ÛŒÙˆØ²Ø±Ù†ÛŒÙ… ÙˆØ§Ø±Ø¯ Ø´Ø¯Ù‡: {username}\n"
        f"   â”œ Ø´Ù…Ø§Ø±Ù‡ Ú©Ø§Ø±Øª: {CARD_NUMBER}\n"
        f"   â”” Ø²Ù…Ø§Ù† Ø³ÙØ§Ø±Ø´: {orders[user_id]['timestamp']}\n\n"
        f"â³ ÙˆØ¶Ø¹ÛŒØª: Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± ØªØ£ÛŒÛŒØ¯\n"
        f"ğŸ“Œ Ù†ÙˆØ¹ Ù…Ø­ØµÙˆÙ„: {orders[user_id]['type'].capitalize()}"
    )
    
    try:
        bot.delete_message(user_id, orders[user_id]["last_message_id"])
    except Exception as e:
        logging.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø­Ø°Ù Ù¾ÛŒØ§Ù… Ù¾Ø±Ø¯Ø§Ø®Øª Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª Ø¨Ø±Ø§ÛŒ Ú©Ø§Ø±Ø¨Ø± {user_id}: {e}")
    
    try:
        bot.forward_message(ADMIN_ID_MAIN, user_id, message.message_id)
        bot.send_message(ADMIN_ID_MAIN, order_details)
        
        bot.forward_message(ADMIN_ID_SECONDARY, user_id, message.message_id)
        bot.send_message(ADMIN_ID_SECONDARY, order_details)
        
        bot.send_message(
            user_id,
            "âœ… ÙÛŒØ´ ÙˆØ§Ø±ÛŒØ² Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø±Ø³Ø§Ù„ Ø´Ø¯. Ù„Ø·ÙØ§Ù‹ Ù…Ù†ØªØ¸Ø± ØªØ£ÛŒÛŒØ¯ Ø§Ø¯Ù…ÛŒÙ† Ø¨Ø§Ø´ÛŒØ¯.\n"
            "â³ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨ÛŒÙ† Ûµ Ø¯Ù‚ÛŒÙ‚Ù‡ ØªØ§ Û± Ø³Ø§Ø¹Øª Ø²Ù…Ø§Ù† Ù…ÛŒâ€ŒØ¨Ø±Ø¯.",
            reply_markup=types.ReplyKeyboardRemove()
        )
        
        show_main_panel(user_id)
        
    except Exception as e:
        logging.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ ÙÛŒØ´: {e}")
        bot.send_message(
            user_id,
            f"âš ï¸ Ø®Ø·Ø§ Ø¯Ø± Ø§Ø±Ø³Ø§Ù„ ÙÛŒØ´! Ù„Ø·ÙØ§Ù‹ Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ† ØªÙ…Ø§Ø³ Ø¨Ú¯ÛŒØ±ÛŒØ¯: {ADMIN_TAG_MAIN}",
            reply_markup=types.ReplyKeyboardRemove()
        )

@bot.message_handler(func=lambda m: m.text == "ğŸ“‹ ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´")
def check_order_status(message):
    if not is_user_subscribed(message.chat.id):
        show_main_panel(message.chat.id)
        return
    
    user_id = message.chat.id
    if user_id not in orders:
        bot.send_message(user_id, "âŒ Ø´Ù…Ø§ Ø³ÙØ§Ø±Ø´ÛŒ Ø«Ø¨Øª Ù†Ú©Ø±Ø¯Ù‡â€ŒØ§ÛŒØ¯!")
        return
    
    order = orders[user_id]
    status_text = (
        f"ğŸ“‹ ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§:\n\n"
        f"ğŸ›’ Ù…Ø­ØµÙˆÙ„: {order['product']}\n"
        f"ğŸ’° Ù…Ø¨Ù„Øº: {order['price']}\n"
        f"ğŸ’³ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª: Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª\n"
        f"ğŸ•’ Ø²Ù…Ø§Ù† Ø³ÙØ§Ø±Ø´: {order['timestamp']}\n"
        f"ğŸ“Œ ÙˆØ¶Ø¹ÛŒØª: {order['status']}\n"
        f"ğŸ“¦ Ù†ÙˆØ¹: {order['type'].capitalize()}\n\n"
    )
    
    if order['status'] == "Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø±Ø³ÛŒ Ø§Ø¯Ù…ÛŒÙ†":
        status_text += "â³ Ù„Ø·ÙØ§Ù‹ ØµØ¨ÙˆØ± Ø¨Ø§Ø´ÛŒØ¯ØŒ Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø±Ø±Ø³ÛŒ ØªÙˆØ³Ø· Ø§Ø¯Ù…ÛŒÙ†..."
    elif order['status'] == "ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡":
        status_text += "âœ… Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§ ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡ Ø§Ø³Øª. Ø¨Ù‡ Ø²ÙˆØ¯ÛŒ ØªÚ©Ù…ÛŒÙ„ Ù…ÛŒâ€ŒØ´ÙˆØ¯."
    elif order['status'] == "ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡":
        status_text += "ğŸ‰ Ø³ÙØ§Ø±Ø´ Ø´Ù…Ø§ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯!"
    
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True, selective=True)
    markup.row("ğŸ”™ Ø¨Ø±Ú¯Ø´Øª")
    
    bot.send_message(user_id, status_text, reply_markup=markup)

@bot.message_handler(func=lambda m: m.text == "ğŸ§‘â€ğŸ’¼ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ†")
def contact_admin(message):
    if not is_user_subscribed(message.chat.id):
        show_main_panel(message.chat.id)
        return
    
    admin_info = (
        "ğŸ“ Ø¨Ø±Ø§ÛŒ Ø§Ø±ØªØ¨Ø§Ø· Ø¨Ø§ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§:\n\n"
        f"ğŸ‘¤ Ø§Ø¯Ù…ÛŒÙ† Ø§ØµÙ„ÛŒ: {ADMIN_TAG_MAIN}\n"
        f"ğŸ‘¤ Ø§Ø¯Ù…ÛŒÙ† Ø¯ÙˆÙ…: {ADMIN_TAG_SECONDARY}\n\n"
        "â³ Ù¾Ø§Ø³Ø® Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¯Ø± Ú©Ù…ØªØ± Ø§Ø² Û± Ø³Ø§Ø¹Øª"
    )
    
    bot.send_message(message.chat.id, admin_info)

@bot.message_handler(func=lambda m: m.text in ["ğŸ”™ Ø¨Ø±Ú¯Ø´Øª", "ğŸ“ Menu"])
def back_to_menu(message):
    show_main_panel(message.chat.id, message.message_id)

@bot.message_handler(commands=['admin'])
def admin_panel(message):
    if message.from_user.id not in [ADMIN_ID_MAIN, ADMIN_ID_SECONDARY]:
        bot.reply_to(message, "âŒ Ø¯Ø³ØªØ±Ø³ÛŒ Ù…Ø­Ø¯ÙˆØ¯ Ø¨Ù‡ Ø§Ø¯Ù…ÛŒÙ†â€ŒÙ‡Ø§!")
        return
    
    markup = types.ReplyKeyboardMarkup(resize_keyboard=True)
    markup.row("ğŸ“¦ Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´Ø§Øª", "ğŸ”„ Ø¢Ù¾Ø¯ÛŒØª ÙˆØ¶Ø¹ÛŒØª")
    markup.row("ğŸ”™ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ")
    
    bot.send_message(
        message.chat.id,
        "ğŸ‘¨â€ğŸ’¼ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª:\n\n"
        "ğŸ“¦ Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´Ø§Øª: Ù…Ø´Ø§Ù‡Ø¯Ù‡ ØªÙ…Ø§Ù… Ø³ÙØ§Ø±Ø´Ø§Øª\n"
        "ğŸ”„ Ø¢Ù¾Ø¯ÛŒØª ÙˆØ¶Ø¹ÛŒØª: ØªØºÛŒÛŒØ± ÙˆØ¶Ø¹ÛŒØª Ø³ÙØ§Ø±Ø´Ø§Øª\n"
        "ğŸ“Œ Ù†Ú©ØªÙ‡: Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ ÛŒØ§ ØªÚ©Ù…ÛŒÙ„ Ø³Ø±ÛŒØ¹ØŒ Ø§Ø² /confirm ÛŒØ§ /complete Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",
        reply_markup=markup
    )

@bot.message_handler(func=lambda m: m.text == "ğŸ“¦ Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´Ø§Øª" and m.from_user.id in [ADMIN_ID_MAIN, ADMIN_ID_SECONDARY])
def list_orders(message):
    if not orders:
        bot.send_message(message.chat.id, "ğŸ“­ Ù‡ÛŒÚ† Ø³ÙØ§Ø±Ø´ÛŒ Ø«Ø¨Øª Ù†Ø´Ø¯Ù‡ Ø§Ø³Øª.")
        return
    
    orders_list = []
    for user_id, order in orders.items():
        try:
            user = bot.get_chat(user_id)
            username = f"@{user.username}" if user.username else "Ù†Ø¯Ø§Ø±Ø¯"
            orders_list.append(
                f"ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø±: {user.first_name or 'Ù†Ø¯Ø§Ø±Ø¯'} (Ø¢ÛŒØ¯ÛŒ: {user_id}, ÛŒÙˆØ²Ø±Ù†ÛŒÙ…: {username})\n"
                f"ğŸ›’ Ù…Ø­ØµÙˆÙ„: {order['product']}\n"
                f"ğŸ’° Ù‚ÛŒÙ…Øª: {order['price']}\n"
                f"ğŸ’³ Ø±ÙˆØ´ Ù¾Ø±Ø¯Ø§Ø®Øª: Ú©Ø§Ø±Øª Ø¨Ù‡ Ú©Ø§Ø±Øª\n"
                f"ğŸ•’ Ø²Ù…Ø§Ù†: {order['timestamp']}\n"
                f"ğŸ“Œ ÙˆØ¶Ø¹ÛŒØª: {order['status']}\n"
                f"ğŸ“¦ Ù†ÙˆØ¹: {order['type'].capitalize()}\n"
                f"ğŸ”¢ Ø´Ù…Ø§Ø±Ù‡ Ø³ÙØ§Ø±Ø´: {hash(str(user_id) + order['timestamp'])}\n"
                "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
            )
        except Exception as e:
            logging.error(f"Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± {user_id}: {e}")
            continue
    
    if not orders_list:
        bot.send_message(message.chat.id, "âŒ Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø³ÙØ§Ø±Ø´Ø§Øª.")
        return
    
    chunk_size = 5
    for i in range(0, len(orders_list), chunk_size):
        chunk = "\n\n".join(orders_list[i:i+chunk_size])
        bot.send_message(message.chat.id, f"ğŸ“¦ Ù„ÛŒØ³Øª Ø³ÙØ§Ø±Ø´Ø§Øª:\n\n{chunk}")

@bot.message_handler(func=lambda m: m.text == "ğŸ”„ Ø¢Ù¾Ø¯ÛŒØª ÙˆØ¶Ø¹ÛŒØª" and m.from_user.id in [ADMIN_ID_MAIN, ADMIN_ID_SECONDARY])
def update_order_status(message):
    if not orders:
        bot.send_message(message.chat.id, "ğŸ“­ Ù‡ÛŒÚ† Ø³ÙØ§Ø±Ø´ÛŒ Ø¨Ø±Ø§ÛŒ Ø¢Ù¾Ø¯ÛŒØª ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯.")
        return
    
    markup = types.ForceReply(selective=False)
    bot.send_message(
        message.chat.id,
        "Ù„Ø·ÙØ§Ù‹ Ø¢ÛŒØ¯ÛŒ Ú©Ø§Ø±Ø¨Ø± Ùˆ ÙˆØ¶Ø¹ÛŒØª Ø¬Ø¯ÛŒØ¯ Ø±Ø§ Ø¨Ù‡ ÙØ±Ù…Øª Ø²ÛŒØ± Ø§Ø±Ø³Ø§Ù„ Ú©Ù†ÛŒØ¯:\n\n"
        "Ø¢ÛŒØ¯ÛŒ_Ú©Ø§Ø±Ø¨Ø±,ÙˆØ¶Ø¹ÛŒØª_Ø¬Ø¯ÛŒØ¯\n\n"
        "Ù…Ø«Ø§Ù„:\n"
        "123456789,ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡\n\n"
        "ÙˆØ¶Ø¹ÛŒØªâ€ŒÙ‡Ø§ÛŒ Ù…Ù…Ú©Ù†: ØªØ£ÛŒÛŒØ¯ Ø´Ø¯Ù‡, Ø±Ø¯ Ø´Ø¯Ù‡, ØªÚ©Ù…ÛŒÙ„ Ø´Ø¯Ù‡\n"
        "ğŸ“Œ ÛŒØ§ Ø§Ø² /confirm Ùˆ /complete Ø¨Ø±Ø§ÛŒ ØªØ£ÛŒÛŒØ¯ ÛŒØ§ ØªÚ©Ù…ÛŒÙ„ Ø³Ø±ÛŒØ¹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ú©Ù†ÛŒØ¯.",
        reply_markup=markup
    )
    
    bot.register_next_step_handler(message, process_status_update)

def process_status_update(message):
    try:
        if message.text == "ğŸ”™ Ù…Ù†ÙˆÛŒ Ø§ØµÙ„ÛŒ":
            show_main_panel(message.chat.id, message.message_id)
            return
        
        user_id, new_status = message.text.split(',')
        user_id = int(user_id.strip())
        new_status = new_status.strip()
        
        if user_id not in orders:
            bot.send_me
